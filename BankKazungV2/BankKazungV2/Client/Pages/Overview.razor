@page "/overview"
@attribute [Authorize]
@inject HttpClient Http
@inject NavigationManager NavigationManager
@using BankKazungV2.Shared.Models

<AuthorizeView Context="Auth">
    <!-- Accounts -->
    <MudContainer Class="mt-5">
        <MudPaper Elevation="3" Class="mb-5 p-3">
            <MudText Typo="Typo.h4">Accounts</MudText>
        </MudPaper>
        <MudGrid>
            @if(accounts != null)
            {
                @foreach (var account in accounts)
                {
                    <MudItem xs="12" sm="6" md="3">
                        <MudPaper Elevation="3">
                            <MudCard>
                                <MudCardHeader Class="mud-theme-primary">
                                    <MudText Typo="Typo.h5">@account.Name</MudText>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudText>@account.Balance</MudText>
                                </MudCardContent>
                            </MudCard>
                        </MudPaper>
                    </MudItem>   
                }
            }
        </MudGrid>
    </MudContainer>
    <!-- Cards -->
    <MudContainer Class="mt-5">
        <MudPaper Elevation="3" Class="mb-5 p-3">
            <MudText Typo="Typo.h4">Cards</MudText>
        </MudPaper>
        <MudGrid>
            @if(cards != null)
            {
                @foreach (var card in cards)
                {
                    <MudItem xs="12" sm="6" md="3">
                        <MudPaper Elevation="3">
                            <MudCard>
                                <MudCardHeader Class="mud-theme-secondary">
                                    <MudText Typo="Typo.h5">@card.Name</MudText>
                                </MudCardHeader>
                                <MudCardContent>
                                    <MudText>@card.Balance</MudText>
                                </MudCardContent>
                            </MudCard>
                        </MudPaper>
                    </MudItem>   
                }
            }
        </MudGrid>
    </MudContainer>
</AuthorizeView>  

@code {
    private Account[]? accounts;
    bool accountsLoading = true;

    private Card[]? cards;
    bool cardsLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            accounts = await Http.GetFromJsonAsync<Account[]>("api/account/all");
            cards = await Http.GetFromJsonAsync<Card[]>("api/card/all");   
        }
        catch
        {
            
        }
    }

    private void ViewAccount(int _accountID)
    {
        Console.WriteLine($"View Account {_accountID}");
        NavigationManager.NavigateTo($"/account/{_accountID}");
    }

    private void ViewCard(int _cardID)
    {
        Console.WriteLine($"View Card {_cardID}");
        NavigationManager.NavigateTo($"/card/{_cardID}");
    }

}
